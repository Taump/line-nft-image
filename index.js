const Koa = require('koa');
const Router = require('@koa/router');
const svg2png = require("svg2png");

const app = new Koa();
const router = new Router();

router.get('/img/:id', async (ctx, next) => {
	const id = ctx.request.params.id;

	ctx.type = "application/json";

	ctx.body = ({
		"name": `Loan #${id}`,
		"image": `https://blog-api.obby.space/image/${id}`,
		"description": `NFT token of ${id} loan`,
	});
});

router.get('/image/:id', async (ctx, next) => {

	const id = ctx.request.params.id;

	const img = `<svg width="296" height="181" viewBox="0 0 296 181" fill="none" xmlns="http://www.w3.org/2000/svg">
	<path d="M60 1H10C4.47715 1 0 5.47715 0 11V61H60V1Z" fill="#030712"/>
	<path opacity="0.3" d="M0 16H60" stroke="#0281EB"/>
	<path opacity="0.3" d="M0 46H60" stroke="#0281EB"/>
	<path opacity="0.1" d="M29.9998 61V1" stroke="#0281EB"/>
	<path d="M119.203 1H59.2034V61H119.203V1Z" fill="#030712"/>
	<path opacity="0.3" d="M59.2034 16H119.203" stroke="#0281EB"/>
	<path opacity="0.3" d="M59.2034 46H119.203" stroke="#0281EB"/>
	<path opacity="0.1" d="M90.2034 61V1" stroke="#0281EB"/>
	<path d="M178.407 1H118.407V61H178.407V1Z" fill="#030712"/>
	<path opacity="0.3" d="M118.407 16H178.407" stroke="#0281EB"/>
	<path opacity="0.3" d="M118.407 46H178.407" stroke="#0281EB"/>
	<path opacity="0.1" d="M148.406 61V1" stroke="#0281EB"/>
	<path d="M237.61 1H177.61V61H237.61V1Z" fill="#030712"/>
	<path opacity="0.3" d="M177.61 16H237.61" stroke="#0281EB"/>
	<path opacity="0.3" d="M177.61 46H237.61" stroke="#0281EB"/>
	<path opacity="0.1" d="M207.61 61V1" stroke="#0281EB"/>
	<path d="M295.797 11C295.797 5.47715 291.319 1 285.797 1H235.797V61H295.797V11Z" fill="#030712"/>
	<path opacity="0.3" d="M235.797 16H295.797" stroke="#0281EB"/>
	<path opacity="0.3" d="M235.797 46H295.797" stroke="#0281EB"/>
	<path opacity="0.1" d="M265.797 61V1" stroke="#0281EB"/>
	<path d="M60 60.332H0V120.332H60V60.332Z" fill="#030712"/>
	<path opacity="0.3" d="M0 75.332H60" stroke="#0281EB"/>
	<path opacity="0.3" d="M0 105.332H60" stroke="#0281EB"/>
	<path opacity="0.1" d="M29.9998 120.332V60.332" stroke="#0281EB"/>
	<path d="M119.203 60.332H59.2031V120.332H119.203V60.332Z" fill="#030712"/>
	<path opacity="0.3" d="M59.2031 75.332H119.203" stroke="#0281EB"/>
	<path opacity="0.3" d="M58.5 105.332H119.203" stroke="#0281EB"/>
	<path opacity="0.1" d="M90.2031 120.332V60.332" stroke="#0281EB"/>
	<path d="M178.407 60.332H118.407V120.332H178.407V60.332Z" fill="#030712"/>
	<path opacity="0.3" d="M118.407 75.332H178.407" stroke="#0281EB"/>
	<path opacity="0.3" d="M118.407 105.332H178.407" stroke="#0281EB"/>
	<path opacity="0.1" d="M148.407 120.332V60.332" stroke="#0281EB"/>
	<path d="M237.61 60.332H177.61V120.332H237.61V60.332Z" fill="#030712"/>
	<path opacity="0.3" d="M177.61 75.332H237.813" stroke="#0281EB"/>
	<path opacity="0.3" d="M177.61 105.332H237.813" stroke="#0281EB"/>
	<path opacity="0.1" d="M207.712 120.332V60.332" stroke="#0281EB"/>
	<path d="M295.797 60.332H235.797V120.332H295.797V60.332Z" fill="#030712"/>
	<path opacity="0.3" d="M235.797 75.332H295.797" stroke="#0281EB"/>
	<path opacity="0.3" d="M235.797 105.332H295.797" stroke="#0281EB"/>
	<path opacity="0.1" d="M265.797 120.332V60.332" stroke="#0281EB"/>
	<path d="M60 119.667H0V169.667C0 175.19 4.47715 179.667 10 179.667H60V119.667Z" fill="#030712"/>
	<path opacity="0.3" d="M0 134.667H60" stroke="#0281EB"/>
	<path opacity="0.3" d="M0 164.666H60" stroke="#0281EB"/>
	<path opacity="0.1" d="M29.9998 179.667V119.667" stroke="#0281EB"/>
	<path d="M119.203 119.667H59.2031V179.667H119.203V119.667Z" fill="#030712"/>
	<path opacity="0.3" d="M59.2031 134.667H119.203" stroke="#0281EB"/>
	<path opacity="0.3" d="M59.2031 164.666H119.203" stroke="#0281EB"/>
	<path opacity="0.1" d="M90.2031 179.667V119.667" stroke="#0281EB"/>
	<path d="M178.407 119.667H118.407V179.667H178.407V119.667Z" fill="#030712"/>
	<path opacity="0.3" d="M118.407 134.667H178.407" stroke="#0281EB"/>
	<path opacity="0.3" d="M118.407 164.666H178.407" stroke="#0281EB"/>
	<path opacity="0.1" d="M148.406 179.667V119.667" stroke="#0281EB"/>
	<path d="M237.61 119.667H177.61V179.667H237.61V119.667Z" fill="#030712"/>
	<path opacity="0.3" d="M177.61 134.667H237.61" stroke="#0281EB"/>
	<path opacity="0.3" d="M177.61 164.666H237.61" stroke="#0281EB"/>
	<path opacity="0.1" d="M207.61 179.667V119.667" stroke="#0281EB"/>
	<path d="M295.797 119.667H235.797V179.667H285.797C291.32 179.667 295.797 175.19 295.797 169.667V119.667Z" fill="#030712"/>
	<path opacity="0.3" d="M235.797 134.667H295.797" stroke="#0281EB"/>
	<path opacity="0.3" d="M235.797 164.666H295.797" stroke="#0281EB"/>
	<path opacity="0.1" d="M265.797 179.667V119.667" stroke="#0281EB"/>
	<path d="M10 1H286C290.971 1 295 5.02944 295 10V171C295 175.971 290.971 180 286 180H10C5.02944 180 1 175.971 1 171V10C1 5.02944 5.02944 1 10 1Z" stroke="#0281EB" stroke-width="2"/>
	<path d="M70 120C86.5685 120 100 106.569 100 90C100 73.4315 86.5685 60 70 60C53.4315 60 40 73.4315 40 90C40 106.569 53.4315 120 70 120Z" stroke="#0281EB" stroke-width="3"/>
	<path d="M52.6924 83.0771H88.4616" stroke="#0281EB" stroke-width="3" stroke-linecap="round"/>
	<path d="M52.6924 96.9229H88.4616" stroke="#0281EB" stroke-width="3" stroke-linecap="round"/>
	<path d="M149.5 105.398C147.36 105.398 145.537 104.815 144.031 103.651C142.526 102.476 141.375 100.777 140.58 98.5511C139.784 96.3163 139.386 93.6174 139.386 90.4545C139.386 87.3106 139.784 84.6259 140.58 82.4006C141.384 80.1657 142.54 78.4612 144.045 77.2869C145.561 76.1032 147.379 75.5114 149.5 75.5114C151.621 75.5114 153.435 76.1032 154.94 77.2869C156.455 78.4612 157.611 80.1657 158.406 82.4006C159.211 84.6259 159.614 87.3106 159.614 90.4545C159.614 93.6174 159.216 96.3163 158.42 98.5511C157.625 100.777 156.474 102.476 154.969 103.651C153.463 104.815 151.64 105.398 149.5 105.398ZM149.5 102.273C151.621 102.273 153.269 101.25 154.443 99.2045C155.617 97.1591 156.205 94.2424 156.205 90.4545C156.205 87.9356 155.935 85.7907 155.395 84.0199C154.865 82.2491 154.098 80.8996 153.094 79.9716C152.099 79.0436 150.902 78.5795 149.5 78.5795C147.398 78.5795 145.755 79.6165 144.571 81.6903C143.387 83.7547 142.795 86.6761 142.795 90.4545C142.795 92.9735 143.061 95.1136 143.591 96.875C144.121 98.6364 144.884 99.9763 145.878 100.895C146.882 101.813 148.089 102.273 149.5 102.273ZM174.5 105.398C172.36 105.398 170.537 104.815 169.031 103.651C167.526 102.476 166.375 100.777 165.58 98.5511C164.784 96.3163 164.386 93.6174 164.386 90.4545C164.386 87.3106 164.784 84.6259 165.58 82.4006C166.384 80.1657 167.54 78.4612 169.045 77.2869C170.561 76.1032 172.379 75.5114 174.5 75.5114C176.621 75.5114 178.435 76.1032 179.94 77.2869C181.455 78.4612 182.611 80.1657 183.406 82.4006C184.211 84.6259 184.614 87.3106 184.614 90.4545C184.614 93.6174 184.216 96.3163 183.42 98.5511C182.625 100.777 181.474 102.476 179.969 103.651C178.463 104.815 176.64 105.398 174.5 105.398ZM174.5 102.273C176.621 102.273 178.269 101.25 179.443 99.2045C180.617 97.1591 181.205 94.2424 181.205 90.4545C181.205 87.9356 180.935 85.7907 180.395 84.0199C179.865 82.2491 179.098 80.8996 178.094 79.9716C177.099 79.0436 175.902 78.5795 174.5 78.5795C172.398 78.5795 170.755 79.6165 169.571 81.6903C168.387 83.7547 167.795 86.6761 167.795 90.4545C167.795 92.9735 168.061 95.1136 168.591 96.875C169.121 98.6364 169.884 99.9763 170.878 100.895C171.882 101.813 173.089 102.273 174.5 102.273ZM199.5 105.398C197.36 105.398 195.537 104.815 194.031 103.651C192.526 102.476 191.375 100.777 190.58 98.5511C189.784 96.3163 189.386 93.6174 189.386 90.4545C189.386 87.3106 189.784 84.6259 190.58 82.4006C191.384 80.1657 192.54 78.4612 194.045 77.2869C195.561 76.1032 197.379 75.5114 199.5 75.5114C201.621 75.5114 203.435 76.1032 204.94 77.2869C206.455 78.4612 207.611 80.1657 208.406 82.4006C209.211 84.6259 209.614 87.3106 209.614 90.4545C209.614 93.6174 209.216 96.3163 208.42 98.5511C207.625 100.777 206.474 102.476 204.969 103.651C203.463 104.815 201.64 105.398 199.5 105.398ZM199.5 102.273C201.621 102.273 203.269 101.25 204.443 99.2045C205.617 97.1591 206.205 94.2424 206.205 90.4545C206.205 87.9356 205.935 85.7907 205.395 84.0199C204.865 82.2491 204.098 80.8996 203.094 79.9716C202.099 79.0436 200.902 78.5795 199.5 78.5795C197.398 78.5795 195.755 79.6165 194.571 81.6903C193.387 83.7547 192.795 86.6761 192.795 90.4545C192.795 92.9735 193.061 95.1136 193.591 96.875C194.121 98.6364 194.884 99.9763 195.878 100.895C196.882 101.813 198.089 102.273 199.5 102.273ZM224.5 105.398C222.36 105.398 220.537 104.815 219.031 103.651C217.526 102.476 216.375 100.777 215.58 98.5511C214.784 96.3163 214.386 93.6174 214.386 90.4545C214.386 87.3106 214.784 84.6259 215.58 82.4006C216.384 80.1657 217.54 78.4612 219.045 77.2869C220.561 76.1032 222.379 75.5114 224.5 75.5114C226.621 75.5114 228.435 76.1032 229.94 77.2869C231.455 78.4612 232.611 80.1657 233.406 82.4006C234.211 84.6259 234.614 87.3106 234.614 90.4545C234.614 93.6174 234.216 96.3163 233.42 98.5511C232.625 100.777 231.474 102.476 229.969 103.651C228.463 104.815 226.64 105.398 224.5 105.398ZM224.5 102.273C226.621 102.273 228.269 101.25 229.443 99.2045C230.617 97.1591 231.205 94.2424 231.205 90.4545C231.205 87.9356 230.935 85.7907 230.395 84.0199C229.865 82.2491 229.098 80.8996 228.094 79.9716C227.099 79.0436 225.902 78.5795 224.5 78.5795C222.398 78.5795 220.755 79.6165 219.571 81.6903C218.387 83.7547 217.795 86.6761 217.795 90.4545C217.795 92.9735 218.061 95.1136 218.591 96.875C219.121 98.6364 219.884 99.9763 220.878 100.895C221.882 101.813 223.089 102.273 224.5 102.273ZM250.239 75.9091V105H246.716V79.6023H246.545L239.443 84.3182V80.7386L246.716 75.9091H250.239Z" fill="#0281EB"/>
	</svg>			
	`;


	ctx.body = await svg2png(img, { width: 592, height: 362 });


	ctx.type = "image/png";
})

app
	.use(router.routes())
	.use(router.allowedMethods());

app.listen(3030);

